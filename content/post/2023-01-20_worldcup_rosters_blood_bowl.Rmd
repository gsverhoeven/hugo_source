---
title: 'Analyzing world cup rosters using clustered heatmaps'
author: "Gertjan Verhoeven"
date: '2023-01-20'
bibliography: heatmap_post/2022_clusterheatmap_blog_post.json
summary: ""
slug: blood-bowl-world-cup
draft: no
categories:
- Blood Bowl
- Clustering
- Statistics
tags:
- R
- hclust
- heatmap
baseurl: https://gsverhoeven.github.io
header:
  image: headers/bb_heatmap_banner.png
  preview: no
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# outline

Yet another Blood Bowl post! This one is on the upcoming World Cup, analyzing variation in Roster choices by top coaches. For the uninitiated: In my spare time I like to play Blood Bowl, a chess-like Board game where two teams play a match of fantasy football. It is set in the Warhammer universe, with teams populated by Orcs, goblins, Elves etc. See my previous blog posts on Blood Bowl for more background and stats.

So the cool thing of Blood Bowl is that it has a highly competitive Tournament scene. With the ultimate tournament of course being the World Cup! The Previous World Cup was held in 2019 in Dornbirn, Austria, and attracted 1400 coaches. This year the World Cup is hosted by Spain, and at least as many coaches are expected in Alicante to battle it out.

Blood Bowl tournaments typically come with a "Rule pack". This describes which teams (see [this post](cluster_post)) are allowed, how much gold coaches have to buy players, and how much skills can be allotted to players to improve their ball handling, or ability to knock other players down.

Bad roster choices will put you at a disadvantage even before the actual game has started. So let's check out what the pro's are using!

# Online Blood Bowl Tournaments on FUMBBL

As described in [this post](fumbbl scraping), Blood Bowl can also be played online. Here we focus on FUMBBL, a Java app that contains the actual Blood Bowl game, linked to a website that performs match making, calculates rankings, provides a forum for discussions etc. 

There are many things great with respect to FUMBBL. Here I like to mention three key elements that allow for this post:

* Online Blood Bowl tournaments are organized on FUMBBL that use exactly the same rules as mayor tabletop tournaments such as Eurobowl,
* FUMBBL has an API where we can fetch data on rosters, 
* FUMBBL stores full replays of all FUMBBL matches, so we can observe how successful rosters can be played

# The 2022 Road to Malta Online NAF tournament

The [Nuffle Amorical Football (NAF)](thenaf.net) is an international association of players dedicated to Blood Bowl, the Games Workshop game of fantasy football. In 2022, the NAF organized an online Tournament "Road to Malta" a few months before the Eurobowl, the European Blood Bowl championship, which took place 4-6 November 2022 in Malta (For a nice impression check [this vid on Youtube](https://www.youtube.com/watch?v=G2JCLe7nikM). The Online Tournament used the exact same ruleset as the Eurobowl itself, and the Rulepack for the 2023 World cup is highly similar.

The **NAF Online Tournaments** FUMBBL group contains the Road To Malta tournaments.

# Fetching the FUMBBL roster data using Python

As this blog post main goal is to share the analysis results, I'll keep the gruelling data collection and preparation part short. We build on previous work where I used web scraping to build a database of matches played on FUMBBL. This dataset allows us to identify the teams that participated in the online NAF tournament. Given these `team_ids`, I wrote a custom Python script `get_team_roster.py` called from a Jupyter notebook (part of the `fumbbl_datasets` Github repository) that 


```{r}
# Load packages
library(tidyverse)
```

```{r}
df_matches <- read.csv(file = "../../../fumbbl_datasets/datasets/current/df_matches.csv")
df_matches$match_date <- as.Date(df_matches$match_date)
df_matches$week_date <- as.Date(df_matches$week_date)
```

```{r}
res <- df_matches %>%
  filter(league == 9298) %>%
  group_by(division_name, tournament_id, division_id, league, ruleset) %>%
  summarise(cnt = n(), start_date = min(match_date), end_date = max(match_date)) %>%
  filter(start_date > as.Date("2022-08-01")) %>%
  arrange(-tournament_id)

res
```


# Final remarks

Just as in other popular games with pre-game deck building, like Magic The Gathering, this automatically leads to a Meta game, where one has to prepare for choices that other coaches make. 


# References



