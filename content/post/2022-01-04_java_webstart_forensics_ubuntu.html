---
title: 'OpenJDK and IcedTea: Java Web Start Forensics on Ubuntu'
author: "Gertjan Verhoeven"
date: '2022-01-04'
summary: To play [Blood Bowl online on FUMBBL.com](https://www.fumbbl.com), a Java
  client is used that must be started using Java Web Start. On my Ubuntu linux system,
  open source versions of java and java web start (openJDK and IcedTea) take care
  of this. This post describes my suffering caused by the client not working anymore
  after a Ubuntu software update, and might be helpfull for others encountering the
  same issues.
slug: java_webstart_forensics_unbuntu
draft: no
categories:
- Linux
- Blood Bowl
tags:
- Ubuntu
- OpenJDK
baseurl: https://gsverhoeven.github.io
header:
  image: headers/bloodbowl_dataset.png
  preview: no
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>To play <a href="https://www.fumbbl.com">Blood Bowl online on FUMBBL.com</a>, a Java client is used that must be started using Java Web Start. On my Ubuntu linux systems (18.04LTS and 20.04LTS), open source versions of java and java web start (openJDK and IcedTea) take care of this. This post describes my suffering caused by the client not working anymore after a Ubuntu software update, and might be helpfull for others encountering the same issues.</p>
<p>From <a href="https://en.wikipedia.org/wiki/Java_Web_Start">wikipedia</a>:</p>
<p><em>Java Web Start was distributed as part of the Java Platform, and included in downloads of the JRE and JDK. It was deprecated by Oracle in Java SE 9 and removed in Java SE 11. The code for Java Web Start was not released by Oracle as part of OpenJDK, and thus OpenJDK originally did not support it. IcedTea-Web provides an independent open source implementation of Java Web Start that is currently developed by the AdoptOpenJDK community, RedHat and Karakun AG, and which is bundled in the official OpenJDK installer.[1]</em></p>
<p>The suffering started on December 19th 2021, when <code>openJDK</code> was automatically upgraded, installing a new <code>java.security</code> file, and left my system unable to run the FUMBBL client using <code>javaws</code>. Fixing the <code>java.security</code> file (see below for details) allowed it to start, but it gave me the dreaded <strong>white bar</strong>, covering part of the chat window and re-roll icons. And the classic <code>unset -v GNOME_DESKTOP_SESSION_ID</code> did not work anymore!</p>
<div id="what-is-up-with-gnome_desktop_session_id" class="section level1">
<h1>What is up with GNOME_DESKTOP_SESSION_ID?</h1>
<pre><code>gertjan:~$ env | grep GNOME_DESK
GNOME_DESKTOP_SESSION_ID=this-is-deprecated</code></pre>
<p><code>unset -v GNOME_DESKTOP_SESSION_ID</code> removes this. In Ubuntu 20.04LTS, this variable is not even present anymore.</p>
<p>Apparently, there is a connection between GNOME and java:</p>
<p><a href="https://bugs.openjdk.java.net/browse/JDK-8247753" class="uri">https://bugs.openjdk.java.net/browse/JDK-8247753</a></p>
<p><em>Java relies on an environment variable GNOME_DESKTOP_SESSION_ID for getting GTK desktop theme. This environmental variable was deprecated earlier and now this got removed in the latest version</em></p>
<p>This provides some hints at why openJDK 11 is not working anymore with the FUMBBL client.
If the client detects a GTK system, it changes it widgets, creating the bar below, and using a different font.
Previously, by unsetting the environment variable, we could prevent the client from detecting GTK.
But since the latest openJDK version, it seems that there is now a different way in which it detects GTK, and we can no longer influence this ourselves.</p>
<p>But as life is short, so I just leave this here as a theory for others to investigate, and went for a workaround instead: downgrading the JRE from version 11 to 8.</p>
</div>
<div id="fixing-the-problem" class="section level1">
<h1>Fixing the problem</h1>
<p>So I decided to look into the matter, forensics style.</p>
<p>From the <code>apt</code> history (<code>/var/log/apt/history.1.gz</code>), I found that on 19 december 2021, a new version of <code>openjdk-11</code> was installed automatically:</p>
<pre><code>Start-Date: 2021-12-19  09:31:26
Commandline: aptdaemon role=&#39;role-commit-packages&#39; sender=&#39;:1.154&#39;
Upgrade: openjdk-11-jre-headless:amd64 (11.0.11+9-0ubuntu2~18.04, 11.0.13+8-0ubuntu1~18.04), openjdk-11-jre:amd64 (11.0.11+9-0ubuntu2~18.04, 11.0.13+8-0ubuntu1~18.04)
End-Date: 2021-12-19  09:35:00</code></pre>
<p>It seems that we went from <code>11.0.11+9-0ubuntu2~18.04</code> to <code>11.0.13+8-0ubuntu1~18.04</code>.
(Which is strange since there were a few releases in between as well according to the CHANGELOG)</p>
<p>Trying to go back using <code>sudo apt-get install openjdk-11-jre-headless:amd64=11.0.11+9-0ubuntu2</code> did not work.
From browsing <a href="https://packages.ubuntu.com/" class="uri">https://packages.ubuntu.com/</a> it seems that only the latest version of the <code>openjdk-11-jre</code> package is available (18.04LTS, codename <strong>bionic</strong>).</p>
<p>Remembering that the FUMBBL client always complains about “requesting JRE 1.6 and getting JRE 11.0” , I decided to try and downgrade openJDK: remove openJDK 11 and only install <code>openJDK-8</code> to force <code>javaws</code> to use JRE 1.8.</p>
<p>To get a clean reproducible situation, I first removed all openJDK software from my system:</p>
<pre><code>sudo apt remove openjdk-11-jdk-headless
sudo apt remove jdk-11.0.9  #(installed this manually in a distant past apparently)
sudo apt remove openjdk-8-jre-headless</code></pre>
<p>This removes all openjdk packages, including <code>icedtea-netx</code>, the package which contains the <code>javaws</code> Java web start to start <code>*.jnlp</code> files.
<code>/usr/lib/jvm</code> is empty now on my system.</p>
<p>I then installed the <code>openjdk-8-jre-headless</code> package:</p>
<pre><code>sudo apt install openjdk-8-jre-headless</code></pre>
<p>After this, I have indeed a working JRE 1.8 environment:</p>
<pre><code>gertjan:~$ java -version
openjdk version &quot;1.8.0_312&quot;
OpenJDK Runtime Environment (build 1.8.0_312-8u312-b07-0ubuntu1~18.04-b07)
OpenJDK 64-Bit Server VM (build 25.312-b07, mixed mode)</code></pre>
<p>However, no <code>javaws</code> (Web start) is present. This is in a separate package called <code>icedtea</code> (something to do with licensing or .</p>
<p>So we do
<code>sudo apt install icedtea-plugin</code></p>
<pre><code>The following NEW packages will be installed:
  default-jre default-jre-headless icedtea-8-plugin icedtea-netx
  icedtea-plugin openjdk-11-jre openjdk-11-jre-headless</code></pre>
<p>So if we want <code>icedtea</code>, we also get <code>openjdk-11</code> as a hard dependency.
Lets play along and install those packages.</p>
<p>This brings <code>javaws</code> to our system:</p>
<pre><code>javaws --version
selected jre: /usr/lib/jvm/default-java
WARNING: package javax.jnlp not in java.desktop
icedtea-web 1.8 (1.8)</code></pre>
<p>It displays a text that gives us a hint how <code>javaws</code> chooses its JRE: by looking at <code>/usr/lib/jvm/default-java</code>.
This is at this point a symbolic link pointing at <code>openjdk-11</code>.
Indeed, starting the FUMBBL client with <code>javaws</code> chooses openjdk 11 automatically.</p>
<pre><code>gertjan:~$ javaws ffblive.jnlp

selected jre: /usr/lib/jvm/default-java
WARNING: package javax.jnlp not in java.desktop
Warning - your JRE - 11.0.13 - does not match requested JRE - 1.6
Warning - your JRE - 11.0.13 - does not match requested JRE - 1.6
Warning - your JRE - 11.0.13 - does not match requested JRE - 1.6
Warning - your JRE - 11.0.13 - does not match requested JRE - 1.6
Codebase matches codebase manifest attribute, and application is signed. Continuing. See: http://docs.oracle.com/javase/7/docs/technotes/guides/jweb/security/no_redeploy.html for details.
Starting application [com.fumbbl.ffb.client.FantasyFootballClient] ...</code></pre>
<p>This gives us the Blood client with the larger font and white bar covering the lower part of the screen.</p>
<p>At first I played with the <code>JAVA_HOME</code> variable, pointing it to <code>/usr/lib/jvm/java-8-openjdk-amd64</code>. This does have effect on <code>javaws</code>, but it gives an error:</p>
<pre><code>thread &#39;main&#39; panicked at &#39;Error spawning JVM process, java executable: [/usr/lib/jvm/java-8-oracle], arguments: [[&quot;-splash:/usr/share/icedtea-web/javaws_splash.png&quot;, &quot;-Xbootclasspath/a:/usr/share/icedtea-web/javaws.jar:/usr/share/java/js.jar:/usr/share/java/tagsoup.jar:/usr/lib/jvm/java-8-oracle/lib/ext/nashorn.jar:&quot;, &quot;-classpath&quot;, &quot;/usr/lib/jvm/java-8-oracle/lib/rt.jar:/usr/lib/jvm/java-8-oracle/lib/ext/jfxrt.jar:&quot;, &quot;-Dicedtea-web.bin.name=javaws&quot;, &quot;-Dicedtea-web.bin.location=/usr/lib/icedtea-web/bin/javaws&quot;, &quot;net.sourceforge.jnlp.runtime.Boot&quot;]]&#39;, src/os_access.rs:36:19
note: Run with `RUST_BACKTRACE=1` for a backtrace</code></pre>
<p>So no messing around with <code>JAVA_HOME</code>.</p>
<p>The trick in the end was to change the symbolic link in <code>/usr/lib/jvm/default-java</code> to point at <code>java-8-openjdk-amd64</code> instead of pointing at <code>java-11-openjdk-amd64</code>.</p>
<pre><code>gertjan:~$ ls /usr/lib/jvm -lt
total 8
drwxr-xr-x 7 root root 4096 jan  4 19:46 java-11-openjdk-amd64
drwxr-xr-x 5 root root 4096 jan  4 19:43 java-8-openjdk-amd64
lrwxrwxrwx 1 root root   20 nov  3 14:54 java-1.8.0-openjdk-amd64 -&gt; java-8-openjdk-amd64
lrwxrwxrwx 1 root root   21 okt 29 11:11 java-1.11.0-openjdk-amd64 -&gt; java-11-openjdk-amd64
lrwxrwxrwx 1 root root   25 feb 20  2019 default-java -&gt; java-1.11.0-openjdk-amd64

gertjan:~$ sudo rm /usr/lib/jvm/default-java

gertjan:~$ cd /usr/lib/jvm/

gertjan:/usr/lib/jvm$ sudo ln -ns java-1.8.0-openjdk-amd64 default-java</code></pre>
<p>Finally, we need fix the <code>java.security</code> thingy by commenting out the following lines in <code>java.security</code> (located somewhere in the <code>/usr/lib/jvm/java-8-openjdk-amd64</code> file tree) with a text editor:</p>
<pre><code>sudo gedit /usr/lib/jvm/default-java/jre/lib/security/java.security </code></pre>
<p>These lines must be commented:</p>
<pre><code>#jdk.jar.disabledAlgorithms=MD2, MD5, RSA keySize &lt; 1024, \
#      DSA keySize &lt; 1024, include jdk.disabled.namedCurves</code></pre>
<p>However, the hurting has not stopped yet on Ubuntu 18.04. <code>openjdk-8</code> throws a new error, about “Assistive Technology” (not seen on Ubuntu 20.04LTS, where I first fixed these problems):</p>
<pre><code>gertjan:~/Downloads$ javaws ffblive.jnlp

selected jre: /usr/lib/jvm/default-java
Exception in thread &quot;main&quot; java.awt.AWTError: Assistive Technology not found: org.GNOME.Accessibility.AtkWrapper
    at java.awt.Toolkit.loadAssistiveTechnologies(Toolkit.java:807)
    at java.awt.Toolkit.getDefaultToolkit(Toolkit.java:886)
    at javax.swing.UIManager.getSystemLookAndFeelClassName(UIManager.java:611)
    at net.sourceforge.jnlp.runtime.JNLPRuntime.initialize(JNLPRuntime.java:221)
    at net.sourceforge.jnlp.runtime.Boot.init(Boot.java:349)
    at net.sourceforge.jnlp.runtime.JnlpBoot.run(JnlpBoot.java:58)
    at net.sourceforge.jnlp.runtime.Boot.run(Boot.java:270)
    at net.sourceforge.jnlp.runtime.Boot.run(Boot.java:63)
    at java.security.AccessController.doPrivileged(Native Method)
    at net.sourceforge.jnlp.runtime.Boot.main(Boot.java:210)</code></pre>
<p>Fortunately, this is a well documented error with an easy solution.</p>
<p><a href="https://askubuntu.com/questions/695560/assistive-technology-not-found-awterror" class="uri">https://askubuntu.com/questions/695560/assistive-technology-not-found-awterror</a></p>
<p>Provided in the form of this oneliner:</p>
<pre><code>sudo sed -i -e &#39;/^assistive_technologies=/s/^/#/&#39; /etc/java-*-openjdk/accessibility.properties`</code></pre>
<p>And finally … we have a working FUMBBL client again, without the white bar! Hurrah!
As long as <code>openjdk-8-jre</code> stays available on Ubuntu universe, I think were good.
Judging from <a href="https://packages.ubuntu.com/search?keywords=openjdk-8-jre">package.ubuntu.com</a>, this package is broadly available, up to the latest Ubuntu versions, so fingers crossed.</p>
</div>
